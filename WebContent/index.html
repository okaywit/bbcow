<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>八牛号外</title>
    <meta name="keywords" content="广告,免费,免费广告" />
    <meta name="description" content="新兴媒体广告推广平台。" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<link href="http://fonts.useso.com/css?family=Noto+Sans+CJK" rel="stylesheet" />
<!-- 新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css">
<style type="text/css">
	body{font-family:'Noto Sans CJK';}
</style>

<body class="container">
	<div class="row" id="ad">
        <div class="col-md-12 col-xs-12">
		    <script type="text/javascript">
		    /*专题页*/
		    var cpro_id = "u1987591";
			</script>
			<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
		</div>
	</div>
	<div class="row">
	    <div class="col-md-9 col-xs-12" role="main">
			<ul class="media-list" id="media">
				<li class="media"></li>
			</ul>
		</div>
		<div class="col-md-3 col-xs-12" role="complementary">
			<nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix">
	            <ul class="nav bs-docs-sidenav" id="l"></ul>
	            <a class="back-to-top" href="#top">
	              	返回顶部
	            </a>
	        </nav>
		</div>
	</div>
	<!-- Button trigger modal -->
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	  	<form method="post">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">号外</h4>
		      </div>
		      <div class="modal-body">
				<input type="text" id="title" required="required" class="form-control" placeholder="标题"/>
		      	<br/>
		      	<textarea class="form-control" id="content" style="resize: none;" maxlength="400" rows="4" placeholder="内容限制400字" required="required"></textarea>
	            <br/>        
	            <input type="text" id="imgUrl"  class="form-control" placeholder="图片地址"/>    
	            <br/>
	            <input type="text" id="contactName" required="required" class="form-control" placeholder="微信、微博、QQ"/>            
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
		        <button type="submit" class="btn btn-primary" onclick="return goRelease()" class="btn btn-success" data-dismiss="modal">发布</button>
		      </div>
		    </div>
	    </form>
	  </div>
	</div>
	
    <nav class="navbar navbar-default navbar-fixed-bottom">
    	<div class="container">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		      <a class="navbar-brand" href="#">八牛号外</a>
		    </div>
	    	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	        	<button  type="button" class="btn btn-success navbar-btn" data-toggle="modal" data-target="#myModal">发布</button>
	        </div>
		</div>
    </nav>
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/socket.js"></script>
    <script type="text/javascript">
        Server.init();
        var i=0;
        Server.socket.onmessage=function(message){
            var data = eval('('+message.data+')');
            if(data["type"]==0){
            	alert("error");
            	
            }
            if(data["type"]==1){
            	var pa = new Paper();
                pa.id=data["data"]["id"]["$numberLong"];
                pa.title=data["data"]["title"];
                pa.content=data["data"]["content"];
                pa.contactName=data["data"]["contactName"];
                pa.contactTel=data["data"]["contactTel"];
                pa.tag=data["data"]["tag"];
                pa.goodCount=data["data"]["goodCount"]["$numberLong"];
                if(pa.goodCount === undefined){
                	pa.goodCount = 0;
                }
                pa.badCount=data["data"]["badCount"]["$numberLong"];
                if(pa.badCount === undefined){
                	pa.badCount = 0;
                }
                pa.imgUrl=data["data"]["imgUrl"];
                pa.packToDemo();
                pa.demoLink();
                i++;
            }
            
            
        };
        function goRelease() {
            var title = document.getElementById("title").value;
            var content = document.getElementById("content").value;
            var contactName = document.getElementById("contactName").value;
            var contactTel = "";//document.getElementById("contactTel").value;
            var tag = "";//document.getElementById("tag").value;
            var imgUrl = document.getElementById("imgUrl").value;
            if(title.replace(/^ +| +$/g,'')==''){
                document.getElementById("title").focus();
                return;
            }
            if(content.replace(/^ +| +$/g,'')==''){
                document.getElementById("content").focus();
                return;
            }
            if(contactName.replace(/^ +| +$/g,'')==''){
                document.getElementById("contactName").focus();
                return;
            }

            var paper = '{"cId":1,"sId":"","data":{"title":"' + title + '","content":"' + content + '","contactName":"' + contactName + '","contactTel":"' + contactTel + '","tag":"' + tag + '","imgUrl":"' + imgUrl + '"}}';
            Server.socket.send(paper);

            document.getElementById("title").value="";
            document.getElementById("content").value="";
            document.getElementById("contactName").value="";
            //document.getElementById("contactTel").value="";
            //document.getElementById("tag").value="";
            document.getElementById("imgUrl").value="";

            return false;
        }

        function Paper(){
            this.id;
            this.title;
            this.content;
            this.contactName;
            this.contactTel;
            this.tag;
            this.imgUrl
            this.goodCount;
            this.badCount;
        }
        Paper.prototype.demoLink=function(){
            var ul = document.getElementById("l");
            var li = document.createElement("li");
            
            var a = document.createElement("a");
            a.setAttribute("href","#"+this.title);
            a.appendChild(document.createTextNode(this.title));
            li.appendChild(a);
            ul.appendChild(li);
        };
        Paper.prototype.packToDemo=function(){
        	var ul = document.getElementById("media");
        	var li = document.createElement("li");
        	li.setAttribute("class","media well")
        	
        	var left = document.createElement("div");
        	left.setAttribute("class", "media-left");
        	left.setAttribute("id", this.title);
        	var a = document.createElement("a");
        	a.setAttribute("href", this.imgUrl);
        	a.setAttribute("target", "_blank");
			var img = document.createElement("img");
			img.setAttribute("class", "media-object");
			img.setAttribute("data-src", "holder.js/64x64");
			img.setAttribute("data-holder-rendered", "true");
			img.setAttribute("style", "width: 64px; height: 64px;");
			img.setAttribute("src",this.imgUrl);
			a.appendChild(img);
        	left.appendChild(a);
        	
        	var body = document.createElement("div");
        	body.setAttribute("class", "media-body");
        	var head = document.createElement("h4");
        	head.setAttribute("class", "media-heading");
        	head.appendChild(document.createTextNode(this.title));
        	var content = document.createElement("p");
        	content.appendChild(document.createTextNode(this.content));
        	var bul = document.createElement("ul");
        	bul.setAttribute("class","nav nav-pills")
        	bul.setAttribute("role","tablist")
        	
        	var bli1 = document.createElement("li");
        	bli1.setAttribute("role","presentation");
        	var a1 = document.createElement("a");
        	a1.setAttribute("href","#");
        	a1.setAttribute("onclick","doLike("+this.id+")");
        	a1.appendChild(document.createTextNode("Good"));
        	var span1 = document.createElement("span");
        	span1.setAttribute("class","badge");
        	span1.appendChild(document.createTextNode(this.goodCount));
        	a1.appendChild(span1);
        	bli1.appendChild(a1);
        	
        	var bli2 = document.createElement("li");
        	bli2.setAttribute("role","presentation");
        	var a2 = document.createElement("a");
        	a2.setAttribute("href","#");
        	a2.appendChild(document.createTextNode("Bad"));
        	var span2 = document.createElement("span");
        	span2.setAttribute("class","badge");
        	span2.appendChild(document.createTextNode(this.badCount));
        	a2.appendChild(span2);
        	bli2.appendChild(a2);
        	bul.appendChild(bli1);
        	bul.appendChild(bli2);
        	body.appendChild(head);
        	body.appendChild(content);
        	body.appendChild(bul);
        	
        	li.appendChild(left);
        	li.appendChild(body);
        	ul.appendChild(li);
           
        };
		function doLike(id){
			 var paper = '{"cId":2,"sId":"","data":{"id":"'+id+'","type":"1","ip":""}}';
	         Server.socket.send(paper);	
		}
		function doNotLike(id){
			 var paper = '{"cId":2,"sId":"","data":{"id":"'+id+'","type":"0","ip":""}}';
	         Server.socket.send(paper);	
		}

    </script>
	<script type="text/javascript">
	    /*内文*/
	var cpro_id = "u1969713";
	</script>
	<script src="http://cpro.baidustatic.com/cpro/ui/cnw.js" type="text/javascript"></script>
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?f3a7b03e683b3dc0971832145b7fadfd";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	
</body>
</html>