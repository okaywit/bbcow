<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>八牛号外</title>
    <meta name="keywords" content="广告,免费,免费广告" />
    <meta name="description" content="新兴媒体广告推广平台。" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<!-- 新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link href='http://fonts.useso.com/css?family=Open+Sans:300,400,600&subset=latin,latin-ext' rel='stylesheet'>

<body class="container">
	<div class="row" id="ad">
        <div class="col-md-12 col-xs-12" id="ad1">
		    <script type="text/javascript">
		    /*专题页*/
		    var cpro_id = "u1987591";
			</script>
			<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
		</div>
	</div>
    <div class="row" id="r">
        <div class="col-md-3 col-xs-12" id="a1">
            <form method="post">
                <div class="panel panel-success">
                    <!-- Default panel contents -->
                    <div class="panel-heading">
                        <button type="submit" onclick="return goRelease()" class="btn btn-success">发布</button>
                    </div>
                    <div class="panel-body">
                        <textarea class="form-control" id="content" style="resize: none;" maxlength="400" rows="8" placeholder="内容限制400字" required="required"></textarea>
                    </div>
                    <!-- Table -->
                    <table class="table">
                        <tr>
                            <td>
                                <input type="text" id="title" required="required" class="form-control" placeholder="标题"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" id="imgUrl"  class="form-control" placeholder="图片地址"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" id="contactName" required="required" class="form-control" placeholder="联系人"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" name="contactTel" id="contactTel" class="form-control"  placeholder="联系方式"/>
                            </td>
                        </tr>
                        <!-- <tr>
                            <td>
                                <input type="text" id="tag" class="form-control" placeholder="标签"/>
                            </td>
                        </tr> -->
                    </table>
                </div>
            </form>
        </div>
    </div>
    
    <nav class="navbar navbar-inverse navbar-fixed-bottom">
        <div class="container">
            <div class="navbar-header">
                <ul class="nav nav-pills">
                    <li role="presentation" class="">
                        <a class="back-to-top" href="#top">回到顶部</a>
                    </li>
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
                            快链<span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" id="l" role="menu"></ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/socket.js"></script>
    <script type="text/javascript">
        Server.init();
        var i=0;
        Server.socket.onmessage=function(message){
            var data = eval('('+message.data+')');
            console.log(data);
            var pa = new Paper();
            pa.id=data["id"];
            pa.title=data["title"];
            pa.content=data["content"];
            pa.contactName=data["contactName"];
            pa.contactTel=data["contactTel"];
            pa.tag=data["tag"];
            pa.imgUrl=data["imgUrl"];
            pa.packToDemo();
            pa.demoLink();
            i++;
        };
        function goRelease() {
            var title = document.getElementById("title").value;
            var content = document.getElementById("content").value;
            var contactName = document.getElementById("contactName").value;
            var contactTel = document.getElementById("contactTel").value;
            var tag = "";//document.getElementById("tag").value;
            var imgUrl = document.getElementById("imgUrl").value;
            if(title.replace(/^ +| +$/g,'')==''){
                document.getElementById("title").focus();
                return;
            }
            if(content.replace(/^ +| +$/g,'')==''){
                document.getElementById("content").focus();
                return;
            }
            if(contactName.replace(/^ +| +$/g,'')==''){
                document.getElementById("contactName").focus();
                return;
            }

            var paper = '{"cId":1,"data":{"title":"' + title + '","content":"' + content + '","contactName":"' + contactName + '","contactTel":"' + contactTel + '","tag":"' + tag + '","imgUrl":"' + imgUrl + '"}}';
            Server.socket.send(paper);

            document.getElementById("title").value="";
            document.getElementById("content").value="";
            document.getElementById("contactName").value="";
            document.getElementById("contactTel").value="";
            //document.getElementById("tag").value="";
            document.getElementById("imgUrl").value="";

            return false;
        }

        function Paper(){
            this.id;
            this.title;
            this.content;
            this.contactName;
            this.contactTel;
            this.tag;
            this.imgUrl
        }
        Paper.prototype.demoLink=function(){
            var ul = document.getElementById("l");
            var li = document.createElement("li");
            var a = document.createElement("a");
            a.setAttribute("href","#"+this.id);
            a.appendChild(document.createTextNode(this.title));
            li.appendChild(a);
            ul.appendChild(li);
        };
        Paper.prototype.packToDemo=function(){
            var div = document.createElement("div");
            div.setAttribute("id", this.id);
            div.setAttribute("class", "col-md-3  col-xs-12");

            var innerDiv = document.createElement("div");
            innerDiv.setAttribute("class", "panel panel-info");

            var head = document.createElement("div");
            head.setAttribute("class", "panel-heading");
            head.appendChild(document.createTextNode(this.title));
            innerDiv.appendChild(head);

            var body = document.createElement("div");
            body.setAttribute("class", "panel-body");
            var img = document.createElement("img");
            img.setAttribute("class", "col-md-12 col-xs-12");
            img.setAttribute("src",this.imgUrl);
            body.appendChild(img);
            innerDiv.appendChild(body);
            
            
            var body = document.createElement("div");
            body.setAttribute("class", "panel-body");
            body.setAttribute("style","word-wrap: break-word;height:120px");
            body.appendChild(document.createTextNode(this.content));
            innerDiv.appendChild(body);

            var table = document.createElement("table");
            table.setAttribute("class", "table");
            var tbody = document.createElement("tbody");

            var tr = document.createElement("tr");
            var td = document.createElement("td");
            var tel = document.createElement("span");
            tel.setAttribute("class","glyphicon glyphicon-phone-alt");
            tel.setAttribute("aria-hidden","true");
            tel.appendChild(document.createTextNode(" "+this.contactName));
            tel.appendChild(document.createTextNode(" "+this.contactTel));
            td.appendChild(tel);
            tr.appendChild(td);
            tbody.appendChild(tr);

            /* var tr1 = document.createElement("tr");
            var td1 = document.createElement("td");
            var tag = document.createElement("span");
            tag.setAttribute("class","glyphicon glyphicon-tags");
            tag.setAttribute("aria-hidden","true");
            tag.appendChild(document.createTextNode(" "+this.tag));
            td1.appendChild(tag);
            tr1.appendChild(td1);
            tbody.appendChild(tr1); */

            table.appendChild(tbody);

            innerDiv.appendChild(table);
            div.appendChild(innerDiv);
            document.getElementById("r").insertBefore(div,document.getElementById(i-1));
        };


    </script>
	<script type="text/javascript">
	    /*内文*/
	var cpro_id = "u1969713";
	</script>
	<script src="http://cpro.baidustatic.com/cpro/ui/cnw.js" type="text/javascript"></script>
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?f3a7b03e683b3dc0971832145b7fadfd";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	
</body>
</html>